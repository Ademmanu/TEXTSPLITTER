# Simple Dockerfile for deploying the bot on Fly.io
FROM python:3.11-slim

# set a working directory
WORKDIR /app

# install build deps and pip requirements
COPY requirements.txt /app/requirements.txt
RUN apt-get update && apt-get install -y --no-install-recommends gcc libpq-dev \
    && pip install --no-cache-dir -r /app/requirements.txt \
    && apt-get remove -y gcc libpq-dev \
    && apt-get autoremove -y \
    && rm -rf /var/lib/apt/lists/*

# copy app
COPY . /app

# create directory for DB if using fly volume mount at /data
RUN mkdir -p /data

# Expose port used by fly (fly sets $PORT at runtime)
ENV PORT=8080
EXPOSE 8080

# Run with gunicorn (1 worker is fine for low-volume bots; increase if needed)
CMD ["gunicorn", "app:app", "--bind", "0.0.0.0:8080", "--workers", "1", "--threads", "4"]